(function(e,t,n,r){function i(r){if(!n[r]){if(!t[r]){if(e)return e(r);throw Error("Cannot find module '"+r+"'")}var s=n[r]={exports:{}};t[r][0](function(e){var n=t[r][1][e];return i(n?n:e)},s,s.exports)}return n[r].exports}for(var s=0;r.length>s;s++)i(r[s]);return i})("undefined"!=typeof require&&require,{1:[function(require){window.gpsTile=require("./gpstile.js")},{"./gpstile.js":2}],2:[function(require,module){function gpsTile(xyz,canvas,cb){osmGpx(proj.bbox(xyz[0],xyz[1],xyz[2]),5,function(err,gpx,gj){draw(canvas,xyz,gj),cb()})}function dist(a,b){return Math.abs(a[0]-b[0])+Math.abs(a[1]-b[1])}function tileProj(ll,xyz){var px=proj.px(ll,xyz[2]);return px[0]-=256*xyz[0],px[1]-=256*xyz[1],[~~px[0],~~px[1]]}function draw(c,xyz,gj){var px,ctx=c.getContext("2d"),color=0;ctx.lineWidth=1,ctx.globalAlpha=.9,ctx.globalCompositeOperation="lighter";for(var i=0;gj.features.length>i;i++){var f=gj.features[i],last=[];if("LineString"==f.geometry.type){var coords=f.geometry.coordinates;if(2>coords.length)continue;ctx.strokeStyle=colors[color++%4],ctx.beginPath(),last=px=tileProj(coords[0],xyz),ctx.moveTo(px[0],px[1]);for(var j=1;coords.length>j;j++){px=tileProj(coords[j],xyz);var d=dist(px,last);d>30?(ctx.stroke(),ctx.strokeStyle=colors[color++%4],ctx.beginPath(),ctx.moveTo(px[0],px[1]),last=px):d>2&&(ctx.lineTo(px[0],px[1]),last=px)}ctx.stroke()}}}var osmGpx=require("osm-gpx"),sph=require("sphericalmercator"),proj=new sph,colors=["cyan","magenta","yellow","#96FFA7"];module.exports=gpsTile},{"osm-gpx":3,sphericalmercator:4}],4:[function(require,module,exports){var SphericalMercator=function(){function SphericalMercator(options){if(options=options||{},this.size=options.size||256,!cache[this.size]){var size=this.size,c=cache[this.size]={};c.Bc=[],c.Cc=[],c.zc=[],c.Ac=[];for(var d=0;30>d;d++)c.Bc.push(size/360),c.Cc.push(size/(2*Math.PI)),c.zc.push(size/2),c.Ac.push(size),size*=2}this.Bc=cache[this.size].Bc,this.Cc=cache[this.size].Cc,this.zc=cache[this.size].zc,this.Ac=cache[this.size].Ac}var cache={},D2R=Math.PI/180,R2D=180/Math.PI,A=6378137,MAXEXTENT=20037508.34;return SphericalMercator.prototype.px=function(ll,zoom){var d=this.zc[zoom],f=Math.min(Math.max(Math.sin(D2R*ll[1]),-.9999),.9999),x=Math.round(d+ll[0]*this.Bc[zoom]),y=Math.round(d+.5*Math.log((1+f)/(1-f))*-this.Cc[zoom]);return x>this.Ac[zoom]&&(x=this.Ac[zoom]),y>this.Ac[zoom]&&(y=this.Ac[zoom]),[x,y]},SphericalMercator.prototype.ll=function(px,zoom){var g=(px[1]-this.zc[zoom])/-this.Cc[zoom],lon=(px[0]-this.zc[zoom])/this.Bc[zoom],lat=R2D*(2*Math.atan(Math.exp(g))-.5*Math.PI);return[lon,lat]},SphericalMercator.prototype.bbox=function(x,y,zoom,tms_style,srs){tms_style&&(y=Math.pow(2,zoom)-1-y);var ll=[x*this.size,(+y+1)*this.size],ur=[(+x+1)*this.size,y*this.size],bbox=this.ll(ll,zoom).concat(this.ll(ur,zoom));return"900913"===srs?this.convert(bbox,"900913"):bbox},SphericalMercator.prototype.xyz=function(bbox,zoom,tms_style,srs){"900913"===srs&&(bbox=this.convert(bbox,"WGS84"));var ll=[bbox[0],bbox[1]],ur=[bbox[2],bbox[3]],px_ll=this.px(ll,zoom),px_ur=this.px(ur,zoom),bounds={minX:Math.floor(px_ll[0]/this.size),minY:Math.floor(px_ur[1]/this.size),maxX:Math.floor((px_ur[0]-1)/this.size),maxY:Math.floor((px_ll[1]-1)/this.size)};if(tms_style){var tms={minY:Math.pow(2,zoom)-1-bounds.maxY,maxY:Math.pow(2,zoom)-1-bounds.minY};bounds.minY=tms.minY,bounds.maxY=tms.maxY}return bounds},SphericalMercator.prototype.convert=function(bbox,to){return"900913"===to?this.forward(bbox.slice(0,2)).concat(this.forward(bbox.slice(2,4))):this.inverse(bbox.slice(0,2)).concat(this.inverse(bbox.slice(2,4)))},SphericalMercator.prototype.forward=function(ll){var xy=[A*ll[0]*D2R,A*Math.log(Math.tan(.25*Math.PI+.5*ll[1]*D2R))];return xy[0]>MAXEXTENT&&(xy[0]=MAXEXTENT),-MAXEXTENT>xy[0]&&(xy[0]=-MAXEXTENT),xy[1]>MAXEXTENT&&(xy[1]=MAXEXTENT),-MAXEXTENT>xy[1]&&(xy[1]=-MAXEXTENT),xy},SphericalMercator.prototype.inverse=function(xy){return[xy[0]*R2D/A,(.5*Math.PI-2*Math.atan(Math.exp(-xy[1]/A)))*R2D]},SphericalMercator}();module!==void 0&&exports!==void 0&&(module.exports=exports=SphericalMercator)},{}],3:[function(require,module){function osmGpx(bbox,pages,callback){function run(page){xml(base+bbox+"&page="+page,function(err,res){if(err)return callback(err,null);var newGj=toGeoJSON.gpx(res.responseXML);--pages&&newGj.features.length?(gj?gj.features=gj.features.concat(newGj.features):gj=newGj,run(++page)):(gj||(gj=newGj),callback(null,res.responseXML,gj))})}callback||(callback=pages,pages=1);var gj=null;return run(0)}var toGeoJSON=require("togeojson"),xml=require("basicrequest"),base="http://api.openstreetmap.org/api/0.6/trackpoints?bbox=";osmGpx.base=function(x){return x?(base=x,osmGpx):base},module!==void 0&&(module.exports=osmGpx)},{togeojson:5,basicrequest:6}],5:[function(require,module){toGeoJSON=function(){function okhash(x){if(!x||!x.length)return 0;for(var i=0,h=0;x.length>i;i++)h=0|(h<<5)-h+x.charCodeAt(i);return h}function get(x,y){return x.getElementsByTagName(y)}function attr(x,y){return x.getAttribute(y)}function attrf(x,y){return parseFloat(attr(x,y))}function get1(x,y){var n=get(x,y);return n.length?n[0]:null}function numarray(x){for(var j=0,o=[];x.length>j;j++)o[j]=parseFloat(x[j]);return o}function nodeVal(x){return x&&x.firstChild&&x.firstChild.nodeValue}function coord1(v){return numarray(v.replace(removeSpace,"").split(","))}function coord(v){for(var coords=v.replace(trimSpace,"").split(splitSpace),o=[],i=0;coords.length>i;i++)o.push(coord1(coords[i]));return o}function fc(){return{type:"FeatureCollection",features:[]}}var removeSpace=/\s*/g,trimSpace=/^\s*|\s*$/g,splitSpace=/\s+/;return t={kml:function(doc,o){function getGeometry(root){var geomNode,geomNodes,i,j,k,geoms=[];if(get1(root,"MultiGeometry"))return getGeometry(get1(root,"MultiGeometry"));for(i=0;geotypes.length>i;i++)if(geomNodes=get(root,geotypes[i]))for(j=0;geomNodes.length>j;j++)if(geomNode=geomNodes[j],"Point"==geotypes[i])geoms.push({type:"Point",coordinates:coord1(nodeVal(get1(geomNode,"coordinates")))});else if("LineString"==geotypes[i])geoms.push({type:"LineString",coordinates:coord(nodeVal(get1(geomNode,"coordinates")))});else if("Polygon"==geotypes[i]){var rings=get(geomNode,"LinearRing"),coords=[];for(k=0;rings.length>k;k++)coords.push(coord(nodeVal(get1(rings[k],"coordinates"))));geoms.push({type:"Polygon",coordinates:coords})}return geoms}function getPlacemark(root){var i,geoms=getGeometry(root),properties={},name=nodeVal(get1(root,"name")),styleUrl=nodeVal(get1(root,"styleUrl")),description=nodeVal(get1(root,"description")),extendedData=get1(root,"ExtendedData");if(!geoms.length)return!1;if(name&&(properties.name=name),styleUrl&&styleIndex[styleUrl]&&(properties.styleUrl=styleUrl,properties.styleHash=styleIndex[styleUrl]),description&&(properties.description=description),extendedData){var datas=get(extendedData,"Data"),simpleDatas=get(extendedData,"SimpleData");for(i=0;datas.length>i;i++)properties[datas[i].getAttribute("name")]=nodeVal(get1(datas[i],"value"));for(i=0;simpleDatas.length>i;i++)properties[simpleDatas[i].getAttribute("name")]=nodeVal(simpleDatas[i])}return[{type:"Feature",geometry:1===geoms.length?geoms[0]:{type:"GeometryCollection",geometries:geoms},properties:properties}]}o=o||{};var gj=fc(),styleIndex={},geotypes=["Polygon","LineString","Point"],placemarks=get(doc,"Placemark"),styles=get(doc,"Style");if(o.styles)for(var k=0;styles.length>k;k++)styleIndex["#"+styles[k].id]=okhash(styles[k].innerHTML).toString(16);for(var j=0;placemarks.length>j;j++)gj.features=gj.features.concat(getPlacemark(placemarks[j]));return gj},gpx:function(doc){var i,j,track,tracks=get(doc,"trk"),gj=fc();for(i=0;tracks.length>i;i++){track=tracks[i];var name=nodeVal(get1(track,"name")),pts=get(track,"trkpt"),line=[];for(j=0;pts.length>j;j++)line.push([attrf(pts[j],"lon"),attrf(pts[j],"lat")]);gj.features.push({type:"Feature",properties:{name:name||""},geometry:{type:"LineString",coordinates:line}})}return gj}}}(),module!==void 0&&(module.exports=toGeoJSON)},{}],6:[function(require,module){module.exports=function(url,callback){var xhr=new XMLHttpRequest,twoHundred=/^20\d$/;xhr.onreadystatechange=function(){4==xhr.readyState&&0!==xhr.status&&(twoHundred.test(xhr.status)?callback(null,xhr):callback(xhr,null))},xhr.onerror=function(e){return callback(e,null)},xhr.open("GET",url,!0),xhr.send()}},{}]},{},[1]);